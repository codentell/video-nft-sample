<!DOCTYPE html>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
    <script src="https://unpkg.com/@livepeer/video-nft@0.3.2/dist/index.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>




<script>

    let ethereum;
    let chainId;

    const apiOpts = {};

    async function connect() {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        ethereum = window.ethereum;
        chainId = window.ethereum.chainId
        console.log(ethereum, chainId)

    }

    async function handleFiles(files) {
        const minter = new videonft.minter.FullMinter(apiOpts, { ethereum, chainId });
        const file = files[0]

        files = [...files]
        console.log(files)
        //initializeProgress(files.length)
        //files.forEach(uploadFile)
        //files.forEach(previewFile)
        // console.log(file)
        // let asset = await minter.api.createAsset('My NFT', file);
        // console.log(asset)
        // // optional, optimizes the video for the NFT
        // asset = await minter.api.nftNormalize(asset);

        // const nftMetadata = {
        //     description: 'My NFT description',
        //     traits: { 'my-custom-trait': 'my-custom-value' }
        // };
        // const ipfs = await minter.api.exportToIPFS(asset.id, nftMetadata);
        // console.log(ipfs);
        // const tx = await minter.web3.mintNft(ipfs.nftMetadataUrl);
        // const nftInfo = await minter.web3.getMintedNftInfo(tx);
        // console.log(`minted NFT on contract ${nftInfo.contractAddress} with ID ${nftInfo.tokenId}`);
        // return nftInfo;

    }

    async function mintNft() {
        console.log(ethereum, chainId)
        const minter = new videonft.minter.FullMinter(apiOpts, { ethereum, chainId });
        const file = await minter.uploader.pickFile();
        console.log(file)
        let asset = await minter.api.createAsset('My NFT', file);
        console.log(asset)
        // optional, optimizes the video for the NFT
        asset = await minter.api.nftNormalize(asset);

        const nftMetadata = {
            description: 'My NFT description',
            traits: { 'my-custom-trait': 'my-custom-value' }
        };
        const ipfs = await minter.api.exportToIPFS(asset.id, nftMetadata);
        console.log(ipfs);
        const tx = await minter.web3.mintNft(ipfs.nftMetadataUrl);
        const nftInfo = await minter.web3.getMintedNftInfo(tx);
        console.log(`minted NFT on contract ${nftInfo.contractAddress} with ID ${nftInfo.tokenId}`);
        return nftInfo;
    }
</script>
<html lang="en" class="dark">

<body>
    <div class="relative flex min-h-screen flex-col justify-center overflow-hidden dark:bg-gray-900 py-6 sm:py-12">
        <div
            class="relative bg-white dark:bg-slate-900 px-6 pt-10 pb-8 shadow-xl ring-1 ring-gray-900/5 sm:mx-auto sm:max-w-lg sm:rounded-lg sm:px-10">
            <div class="mx-auto max-w-md">
                <div class=" text-base font-semibold leading-7">
                    <p class="text-white">Upload Video</p>
                </div>
                <div class="divide-y divide-gray-300/50">
                    <div class="space-y-6 py-8 text-base leading-7 text-white">

                        <div class=" text-base font-semibold leading-7">
                            <p class="text-white">Attach Video</p>
                        </div>
                        <section id="drop-area"
                            class="outline-dashed outline-2 outline-offset-2 outline-white p-2 rounded-md">
                            <input class="h-32 w-full" type="file" id="file" accept="video/mp4"
                                onchange="handleFiles(this.files)">
                        </section>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
                            <div class="bg-[#00eb88] h-2.5 rounded-full" style="width: 45%"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- <section>

        <h1>Upload Video</h1>

        <form>
            <label>Video NFT Title</label>
            <input type="text" />

            <section id="drop-area">
                <label>Attach Video</label>
                <input type="file" id="file" accept="video/mp4" onchange="handleFiles(this.files)">
                <progress id="progress-bar" max=100 value=0></progress>
            </section>



        </form>






    </section>
    <button onClick="connect()">Connect</button>
    <button onClick="mintNft()">Upload</button> -->

</body>
<script>
    let dropArea = document.getElementById("drop-area")
    console.log(dropArea);

    // Prevent default drag behaviors
    ;['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false)
        document.body.addEventListener(eventName, preventDefaults, false)
    });


    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false)
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false)
    });

    function highlight(e) {

        dropArea.classList.add('outline-[#00eb88]')
    }

    function unhighlight(e) {
        dropArea.classList.remove('outline-[#00eb88]')
    }

    // Handle dropped files
    console.log(dropArea);
    dropArea.addEventListener('drop', handleDrop, false)

    function preventDefaults(e) {
        e.preventDefault()
        e.stopPropagation()
    }

    function handleDrop(e) {
        var dt = e.dataTransfer
        var files = dt.files

        handleFiles(files)
    }
</script>

</html>